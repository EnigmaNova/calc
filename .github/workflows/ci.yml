name: Java CI

on:
  push:
    branches: [ dev, stage, main ]
  pull_request:
    branches: [ dev, stage, main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up JDK 20
      uses: actions/setup-java@v3
      with:
        java-version: '20'
        distribution: 'temurin'
    
    - name: Show project structure
      run: |
        echo "üìÅ Current directory:"
        pwd
        ls -la
        echo "üìÇ Looking for Java files:"
        find . -name "*.java" -type f | sort
    
    - name: Compile Calculator
      run: |
        # –ò—â–µ–º Java —Ñ–∞–π–ª—ã –≥–¥–µ —É–≥–æ–¥–Ω–æ (–Ω–µ —Ç–æ–ª—å–∫–æ –≤ src/)
        find . -name "*.java" -type f > sources.txt
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–∞—à–ª–∏
        if [ ! -s sources.txt ]; then
          echo "‚ùå No Java files found in the entire repository!"
          exit 1
        fi
        
        echo "üìã Found Java files:"
        cat sources.txt
        
        # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
        mkdir -p out
        
        # –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
        javac -d out @sources.txt
        
        if [ $? -eq 0 ]; then
          echo "‚úÖ Compilation successful!"
          echo "üì¶ Compiled classes:"
          find out -name "*.class" | sed 's|out/||'
        else
          echo "‚ùå Compilation failed"
          exit 1
        fi