name: Java CI

on:
  push:
    branches: [ dev, stage, main ]
  pull_request:
    branches: [ dev, stage, main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up JDK 20
      uses: actions/setup-java@v3
      with:
        java-version: '20'
        distribution: 'temurin'
    
    - name: Show project structure
      run: |
        echo "üìÅ Project structure:"
        ls -la
        echo "üìÇ Src folder:"
        ls -la src/ || echo "src folder not found"
    
    - name: Compile Calculator
      run: |
        # –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ Java —Ñ–∞–π–ª—ã –≤ src
        find src -name "*.java" > sources.txt
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª—ã –Ω–∞–π–¥–µ–Ω—ã
        if [ ! -s sources.txt ]; then
          echo "‚ùå No Java files found in src/"
          exit 1
        fi
        
        echo "üìã Compiling:"
        cat sources.txt
        
        # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
        mkdir -p out
        
        # –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º
        javac -d out @sources.txt
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        if [ $? -eq 0 ]; then
          echo "‚úÖ Compilation successful!"
          echo "üì¶ Compiled classes:"
          find out -name "*.class" | sed 's/out\///'
        else
          echo "‚ùå Compilation failed"
          exit 1
        fi
    
    - name: Verify Calculator class
      run: |
        if [ -f "out/Calculator.class" ]; then
          echo "‚úÖ Calculator.class created"
        else
          echo "‚ö†Ô∏è Calculator.class not found, but other classes may exist"
        fi